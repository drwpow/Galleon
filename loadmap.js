// Google Maps InfoBox
eval(function(p,a,c,k,e,r){e=function(c){return(c<a?'':e(parseInt(c/a)))+((c=c%a)>35?String.fromCharCode(c+29):c.toString(36))};if(!''.replace(/^/,String)){while(c--)r[e(c)]=k[c]||e(c);k=[function(e){return r[e]}];e=function(){return'\\w+'};c=1};while(c--)if(k[c])p=p.replace(new RegExp('\\b'+e(c)+'\\b','g'),k[c]);return p}('6 8(a){a=a||{};9.p.1O.2h(2,33);2.M=a.1s||"";2.1A=a.1n||G;2.Y=a.1F||0;2.E=a.1y||1e 9.p.1V(0,0);2.z=a.X||1e 9.p.2x(0,0);2.T=a.S||t;2.1k=a.1j||"2d";2.1i=a.D||{};2.1C=a.1B||"35";2.K=a.1g||"31://2W.9.2Q/2J/2I/2G/1v.2D";3(a.1g===""){2.K=""}2.17=a.1x||1e 9.p.1V(1,1);2.V=a.1o||G;2.16=a.1m||G;2.1J=a.2j||"2g";2.14=a.1q||G;2.4=t;2.w=t;2.P=t;2.O=t;2.B=t;2.N=t}8.q=1e 9.p.1O();8.q.24=6(){5 i;5 f;5 a;5 d=2;5 c=6(e){e.21=Z;3(e.15){e.15()}};5 b=6(e){e.2Z=G;3(e.1Y){e.1Y()}3(!d.14){c(e)}};3(!2.4){2.4=1f.2P("2M");2.1d();3(s 2.M.1r==="r"){2.4.L=2.F()+2.M}v{2.4.L=2.F();2.4.1a(2.M)}2.2C()[2.1J].1a(2.4);2.1z();3(2.4.7.C){2.N=Z}v{3(2.Y!==0&&2.4.W>2.Y){2.4.7.C=2.Y;2.4.7.2z="2w";2.N=Z}v{a=2.1N();2.4.7.C=(2.4.W-a.Q-a.13)+"12";2.N=G}}2.1p(2.1A);3(!2.14){2.B=[];f=["2p","1L","2o","2n","1K","2m","2l","2k","2i"];1l(i=0;i<f.1I;i++){2.B.1H(9.p.u.19(2.4,f[i],c))}2.B.1H(9.p.u.19(2.4,"1L",6(e){2.7.1G="2f"}))}2.O=9.p.u.19(2.4,"2e",b);9.p.u.R(2,"2c")}};8.q.F=6(){5 a="";3(2.K!==""){a="<2b";a+=" 2a=\'"+2.K+"\'";a+=" 29=13";a+=" 7=\'";a+=" X: 28;";a+=" 1G: 27;";a+=" 26: "+2.1C+";";a+="\'>"}J a};8.q.1z=6(){5 a;3(2.K!==""){a=2.4.3d;2.w=9.p.u.19(a,\'1K\',2.25())}v{2.w=t}};8.q.25=6(){5 a=2;J 6(e){e.21=Z;3(e.15){e.15()}9.p.u.R(a,"3c");a.1v()}};8.q.1p=6(d){5 m;5 n;5 e=0,H=0;3(!d){m=2.3a();3(m 39 9.p.38){3(!m.23().37(2.z)){m.36(2.z)}n=m.23();5 a=m.34();5 h=a.W;5 f=a.22;5 k=2.E.C;5 l=2.E.1h;5 g=2.4.W;5 b=2.4.22;5 i=2.17.C;5 j=2.17.1h;5 o=2.20().32(2.z);3(o.x<(-k+i)){e=o.x+k-i}v 3((o.x+g+k+i)>h){e=o.x+g+k+i-h}3(2.16){3(o.y<(-l+j+b)){H=o.y+l-j-b}v 3((o.y+l+j)>f){H=o.y+l+j-f}}v{3(o.y<(-l+j)){H=o.y+l-j}v 3((o.y+b+l+j)>f){H=o.y+b+l+j-f}}3(!(e===0&&H===0)){5 c=m.30();m.2Y(e,H)}}}};8.q.1d=6(){5 i,D;3(2.4){2.4.2X=2.1k;2.4.7.2V="";D=2.1i;1l(i 2U D){3(D.2R(i)){2.4.7[i]=D[i]}}3(s 2.4.7.18!=="r"&&2.4.7.18!==""){2.4.7.2O="2N(18="+(2.4.7.18*2L)+")"}2.4.7.X="2K";2.4.7.11=\'1u\';3(2.T!==t){2.4.7.S=2.T}}};8.q.1N=6(){5 c;5 a={1c:0,1b:0,Q:0,13:0};5 b=2.4;3(1f.1t&&1f.1t.1W){c=b.2H.1t.1W(b,"");3(c){a.1c=A(c.1U,10)||0;a.1b=A(c.1T,10)||0;a.Q=A(c.1X,10)||0;a.13=A(c.1S,10)||0}}v 3(1f.2F.I){3(b.I){a.1c=A(b.I.1U,10)||0;a.1b=A(b.I.1T,10)||0;a.Q=A(b.I.1X,10)||0;a.13=A(b.I.1S,10)||0}}J a};8.q.2E=6(){3(2.4){2.4.2S.2T(2.4);2.4=t}};8.q.1E=6(){2.24();5 a=2.20().2B(2.z);2.4.7.Q=(a.x+2.E.C)+"12";3(2.16){2.4.7.1b=-(a.y+2.E.1h)+"12"}v{2.4.7.1c=(a.y+2.E.1h)+"12"}3(2.V){2.4.7.11=\'1u\'}v{2.4.7.11="1R"}};8.q.2A=6(a){3(s a.1j!=="r"){2.1k=a.1j;2.1d()}3(s a.D!=="r"){2.1i=a.D;2.1d()}3(s a.1s!=="r"){2.1Q(a.1s)}3(s a.1n!=="r"){2.1A=a.1n}3(s a.1F!=="r"){2.Y=a.1F}3(s a.1y!=="r"){2.E=a.1y}3(s a.1m!=="r"){2.16=a.1m}3(s a.X!=="r"){2.1w(a.X)}3(s a.S!=="r"){2.1P(a.S)}3(s a.1B!=="r"){2.1C=a.1B}3(s a.1g!=="r"){2.K=a.1g}3(s a.1x!=="r"){2.17=a.1x}3(s a.1o!=="r"){2.V=a.1o}3(s a.1q!=="r"){2.14=a.1q}3(2.4){2.1E()}};8.q.1Q=6(a){2.M=a;3(2.4){3(2.w){9.p.u.U(2.w);2.w=t}3(!2.N){2.4.7.C=""}3(s a.1r==="r"){2.4.L=2.F()+a}v{2.4.L=2.F();2.4.1a(a)}3(!2.N){2.4.7.C=2.4.W+"12";3(s a.1r==="r"){2.4.L=2.F()+a}v{2.4.L=2.F();2.4.1a(a)}}2.1z()}9.p.u.R(2,"2y")};8.q.1w=6(a){2.z=a;3(2.4){2.1E()}9.p.u.R(2,"1Z")};8.q.1P=6(a){2.T=a;3(2.4){2.4.7.S=a}9.p.u.R(2,"2v")};8.q.2u=6(){J 2.M};8.q.1D=6(){J 2.z};8.q.2t=6(){J 2.T};8.q.2s=6(){2.V=G;3(2.4){2.4.7.11="1R"}};8.q.2r=6(){2.V=Z;3(2.4){2.4.7.11="1u"}};8.q.2q=6(c,b){5 a=2;3(b){2.z=b.1D();2.P=9.p.u.3b(b,"1Z",6(){a.1w(2.1D())})}2.1M(c);3(2.4){2.1p()}};8.q.1v=6(){5 i;3(2.w){9.p.u.U(2.w);2.w=t}3(2.B){1l(i=0;i<2.B.1I;i++){9.p.u.U(2.B[i])}2.B=t}3(2.P){9.p.u.U(2.P);2.P=t}3(2.O){9.p.u.U(2.O);2.O=t}2.1M(t)};',62,200,'||this|if|div_|var|function|style|InfoBox|google||||||||||||||||maps|prototype|undefined|typeof|null|event|else|closeListener_|||position_|parseInt|eventListeners_|width|boxStyle|pixelOffset_|getCloseBoxImg_|false|yOffset|currentStyle|return|closeBoxURL_|innerHTML|content_|fixedWidthSet_|contextListener_|moveListener_|left|trigger|zIndex|zIndex_|removeListener|isHidden_|offsetWidth|position|maxWidth_|true||visibility|px|right|enableEventPropagation_|stopPropagation|alignBottom_|infoBoxClearance_|opacity|addDomListener|appendChild|bottom|top|setBoxStyle_|new|document|closeBoxURL|height|boxStyle_|boxClass|boxClass_|for|alignBottom|disableAutoPan|isHidden|panBox_|enableEventPropagation|nodeType|content|defaultView|hidden|close|setPosition|infoBoxClearance|pixelOffset|addClickHandler_|disableAutoPan_|closeBoxMargin|closeBoxMargin_|getPosition|draw|maxWidth|cursor|push|length|pane_|click|mouseover|setMap|getBoxWidths_|OverlayView|setZIndex|setContent|visible|borderRightWidth|borderBottomWidth|borderTopWidth|Size|getComputedStyle|borderLeftWidth|preventDefault|position_changed|getProjection|cancelBubble|offsetHeight|getBounds|createInfoBoxDiv_|getCloseClickHandler_|margin|pointer|relative|align|src|img|domready|infoBox|contextmenu|default|floatPane|apply|touchmove|pane|touchend|touchstart|dblclick|mouseup|mouseout|mousedown|open|hide|show|getZIndex|getContent|zindex_changed|auto|LatLng|content_changed|overflow|setOptions|fromLatLngToDivPixel|getPanes|gif|onRemove|documentElement|mapfiles|ownerDocument|en_us|intl|absolute|100|div|alpha|filter|createElement|com|hasOwnProperty|parentNode|removeChild|in|cssText|www|className|panBy|returnValue|getCenter|http|fromLatLngToContainerPixel|arguments|getDiv|2px|setCenter|contains|Map|instanceof|getMap|addListener|closeclick|firstChild'.split('|'),0,{}))
// Google Maps Cluster
//function MarkerClusterer(a,b,c){this.extend(MarkerClusterer,google.maps.OverlayView),this.map_=a,this.markers_=[],this.clusters_=[],this.sizes=[53,56,66,78,90],this.styles_=[],this.ready_=!1;var d=c||{};this.gridSize_=d.gridSize||60,this.minClusterSize_=d.minimumClusterSize||2,this.maxZoom_=d.maxZoom||null,this.styles_=d.styles||[],this.imagePath_=d.imagePath||this.MARKER_CLUSTER_IMAGE_PATH_,this.imageExtension_=d.imageExtension||this.MARKER_CLUSTER_IMAGE_EXTENSION_,this.zoomOnClick_=!0,d["zoomOnClick"]!=undefined&&(this.zoomOnClick_=d.zoomOnClick),this.averageCenter_=!1,d["averageCenter"]!=undefined&&(this.averageCenter_=d.averageCenter),this.setupStyles_(),this.setMap(a),this.prevZoom_=this.map_.getZoom();var e=this;google.maps.event.addListener(this.map_,"zoom_changed",function(){var a=e.map_.getZoom();e.prevZoom_!=a&&(e.prevZoom_=a,e.resetViewport())}),google.maps.event.addListener(this.map_,"idle",function(){e.redraw()}),b&&b.length&&this.addMarkers(b,!1)}function Cluster(a){this.markerClusterer_=a,this.map_=a.getMap(),this.gridSize_=a.getGridSize(),this.minClusterSize_=a.getMinClusterSize(),this.averageCenter_=a.isAverageCenter(),this.center_=null,this.markers_=[],this.bounds_=null,this.clusterIcon_=new ClusterIcon(this,a.getStyles(),a.getGridSize())}function ClusterIcon(a,b,c){a.getMarkerClusterer().extend(ClusterIcon,google.maps.OverlayView),this.styles_=b,this.padding_=c||0,this.cluster_=a,this.center_=null,this.map_=a.getMap(),this.div_=null,this.sums_=null,this.visible_=!1,this.setMap(this.map_)}MarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_PATH_="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclusterer/images/m",MarkerClusterer.prototype.MARKER_CLUSTER_IMAGE_EXTENSION_="png",MarkerClusterer.prototype.extend=function(a,b){return function(a){for(var b in a.prototype)this.prototype[b]=a.prototype[b];return this}.apply(a,[b])},MarkerClusterer.prototype.onAdd=function(){this.setReady_(!0)},MarkerClusterer.prototype.draw=function(){},MarkerClusterer.prototype.setupStyles_=function(){if(this.styles_.length)return;for(var a=0,b;b=this.sizes[a];a++)this.styles_.push({url:this.imagePath_+(a+1)+"."+this.imageExtension_,height:b,width:b})},MarkerClusterer.prototype.fitMapToMarkers=function(){var a=this.getMarkers(),b=new google.maps.LatLngBounds;for(var c=0,d;d=a[c];c++)b.extend(d.getPosition());this.map_.fitBounds(b)},MarkerClusterer.prototype.setStyles=function(a){this.styles_=a},MarkerClusterer.prototype.getStyles=function(){return this.styles_},MarkerClusterer.prototype.isZoomOnClick=function(){return this.zoomOnClick_},MarkerClusterer.prototype.isAverageCenter=function(){return this.averageCenter_},MarkerClusterer.prototype.getMarkers=function(){return this.markers_},MarkerClusterer.prototype.getTotalMarkers=function(){return this.markers_.length},MarkerClusterer.prototype.setMaxZoom=function(a){this.maxZoom_=a},MarkerClusterer.prototype.getMaxZoom=function(){return this.maxZoom_},MarkerClusterer.prototype.calculator_=function(a,b){var c=0,d=a.length,e=d;while(e!==0)e=parseInt(e/10,10),c++;return c=Math.min(c,b),{text:d,index:c}},MarkerClusterer.prototype.setCalculator=function(a){this.calculator_=a},MarkerClusterer.prototype.getCalculator=function(){return this.calculator_},MarkerClusterer.prototype.addMarkers=function(a,b){for(var c=0,d;d=a[c];c++)this.pushMarkerTo_(d);b||this.redraw()},MarkerClusterer.prototype.pushMarkerTo_=function(a){a.isAdded=!1;if(a.draggable){var b=this;google.maps.event.addListener(a,"dragend",function(){a.isAdded=!1,b.repaint()})}this.markers_.push(a)},MarkerClusterer.prototype.addMarker=function(a,b){this.pushMarkerTo_(a),b||this.redraw()},MarkerClusterer.prototype.removeMarker_=function(a){var b=-1;if(this.markers_.indexOf)b=this.markers_.indexOf(a);else for(var c=0,d;d=this.markers_[c];c++)if(d==a){b=c;break}return b==-1?!1:(a.setMap(null),this.markers_.splice(b,1),!0)},MarkerClusterer.prototype.removeMarker=function(a,b){var c=this.removeMarker_(a);return!b&&c?(this.resetViewport(),this.redraw(),!0):!1},MarkerClusterer.prototype.removeMarkers=function(a,b){var c=!1;for(var d=0,e;e=a[d];d++){var f=this.removeMarker_(e);c=c||f}if(!b&&c)return this.resetViewport(),this.redraw(),!0},MarkerClusterer.prototype.setReady_=function(a){this.ready_||(this.ready_=a,this.createClusters_())},MarkerClusterer.prototype.getTotalClusters=function(){return this.clusters_.length},MarkerClusterer.prototype.getMap=function(){return this.map_},MarkerClusterer.prototype.setMap=function(a){this.map_=a},MarkerClusterer.prototype.getGridSize=function(){return this.gridSize_},MarkerClusterer.prototype.setGridSize=function(a){this.gridSize_=a},MarkerClusterer.prototype.getMinClusterSize=function(){return this.minClusterSize_},MarkerClusterer.prototype.setMinClusterSize=function(a){this.minClusterSize_=a},MarkerClusterer.prototype.getExtendedBounds=function(a){var b=this.getProjection(),c=new google.maps.LatLng(a.getNorthEast().lat(),a.getNorthEast().lng()),d=new google.maps.LatLng(a.getSouthWest().lat(),a.getSouthWest().lng()),e=b.fromLatLngToDivPixel(c);e.x+=this.gridSize_,e.y-=this.gridSize_;var f=b.fromLatLngToDivPixel(d);f.x-=this.gridSize_,f.y+=this.gridSize_;var g=b.fromDivPixelToLatLng(e),h=b.fromDivPixelToLatLng(f);return a.extend(g),a.extend(h),a},MarkerClusterer.prototype.isMarkerInBounds_=function(a,b){return b.contains(a.getPosition())},MarkerClusterer.prototype.clearMarkers=function(){this.resetViewport(!0),this.markers_=[]},MarkerClusterer.prototype.resetViewport=function(a){for(var b=0,c;c=this.clusters_[b];b++)c.remove();for(var b=0,d;d=this.markers_[b];b++)d.isAdded=!1,a&&d.setMap(null);this.clusters_=[]},MarkerClusterer.prototype.repaint=function(){var a=this.clusters_.slice();this.clusters_.length=0,this.resetViewport(),this.redraw(),window.setTimeout(function(){for(var b=0,c;c=a[b];b++)c.remove()},0)},MarkerClusterer.prototype.redraw=function(){this.createClusters_()},MarkerClusterer.prototype.distanceBetweenPoints_=function(a,b){if(!a||!b)return 0;var c=6371,d=(b.lat()-a.lat())*Math.PI/180,e=(b.lng()-a.lng())*Math.PI/180,f=Math.sin(d/2)*Math.sin(d/2)+Math.cos(a.lat()*Math.PI/180)*Math.cos(b.lat()*Math.PI/180)*Math.sin(e/2)*Math.sin(e/2),g=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),h=c*g;return h},MarkerClusterer.prototype.addToClosestCluster_=function(a){var b=4e4,c=null,d=a.getPosition();for(var e=0,f;f=this.clusters_[e];e++){var g=f.getCenter();if(g){var h=this.distanceBetweenPoints_(g,a.getPosition());h<b&&(b=h,c=f)}}if(c&&c.isMarkerInClusterBounds(a))c.addMarker(a);else{var f=new Cluster(this);f.addMarker(a),this.clusters_.push(f)}},MarkerClusterer.prototype.createClusters_=function(){if(!this.ready_)return;var a=new google.maps.LatLngBounds(this.map_.getBounds().getSouthWest(),this.map_.getBounds().getNorthEast()),b=this.getExtendedBounds(a);for(var c=0,d;d=this.markers_[c];c++)!d.isAdded&&this.isMarkerInBounds_(d,b)&&this.addToClosestCluster_(d)},Cluster.prototype.isMarkerAlreadyAdded=function(a){if(this.markers_.indexOf)return this.markers_.indexOf(a)!=-1;for(var b=0,c;c=this.markers_[b];b++)if(c==a)return!0;return!1},Cluster.prototype.addMarker=function(a){if(this.isMarkerAlreadyAdded(a))return!1;if(!this.center_)this.center_=a.getPosition(),this.calculateBounds_();else if(this.averageCenter_){var b=this.markers_.length+1,c=(this.center_.lat()*(b-1)+a.getPosition().lat())/b,d=(this.center_.lng()*(b-1)+a.getPosition().lng())/b;this.center_=new google.maps.LatLng(c,d),this.calculateBounds_()}a.isAdded=!0,this.markers_.push(a);var e=this.markers_.length;e<this.minClusterSize_&&a.getMap()!=this.map_&&a.setMap(this.map_);if(e==this.minClusterSize_)for(var f=0;f<e;f++)this.markers_[f].setMap(null);return e>=this.minClusterSize_&&a.setMap(null),this.updateIcon(),!0},Cluster.prototype.getMarkerClusterer=function(){return this.markerClusterer_},Cluster.prototype.getBounds=function(){var a=new google.maps.LatLngBounds(this.center_,this.center_),b=this.getMarkers();for(var c=0,d;d=b[c];c++)a.extend(d.getPosition());return a},Cluster.prototype.remove=function(){this.clusterIcon_.remove(),this.markers_.length=0,delete this.markers_},Cluster.prototype.getSize=function(){return this.markers_.length},Cluster.prototype.getMarkers=function(){return this.markers_},Cluster.prototype.getCenter=function(){return this.center_},Cluster.prototype.calculateBounds_=function(){var a=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(a)},Cluster.prototype.isMarkerInClusterBounds=function(a){return this.bounds_.contains(a.getPosition())},Cluster.prototype.getMap=function(){return this.map_},Cluster.prototype.updateIcon=function(){var a=this.map_.getZoom(),b=this.markerClusterer_.getMaxZoom();if(b&&a>b){for(var c=0,d;d=this.markers_[c];c++)d.setMap(this.map_);return}if(this.markers_.length<this.minClusterSize_){this.clusterIcon_.hide();return}var e=this.markerClusterer_.getStyles().length,f=this.markerClusterer_.getCalculator()(this.markers_,e);this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.setSums(f),this.clusterIcon_.show()},ClusterIcon.prototype.triggerClusterClick=function(){var a=this.cluster_.getMarkerClusterer();google.maps.event.trigger(a,"clusterclick",this.cluster_),a.isZoomOnClick()&&this.map_.fitBounds(this.cluster_.getBounds())},ClusterIcon.prototype.onAdd=function(){this.div_=document.createElement("DIV");if(this.visible_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(a),this.div_.innerHTML=this.sums_.text}var b=this.getPanes();b.overlayMouseTarget.appendChild(this.div_);var c=this;google.maps.event.addDomListener(this.div_,"click",function(){c.triggerClusterClick()})},ClusterIcon.prototype.getPosFromLatLng_=function(a){var b=this.getProjection().fromLatLngToDivPixel(a);return b.x-=parseInt(this.width_/2,10),b.y-=parseInt(this.height_/2,10),b},ClusterIcon.prototype.draw=function(){if(this.visible_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.top=a.y+"px",this.div_.style.left=a.x+"px"}},ClusterIcon.prototype.hide=function(){this.div_&&(this.div_.style.display="none"),this.visible_=!1},ClusterIcon.prototype.show=function(){if(this.div_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.cssText=this.createCss(a),this.div_.style.display=""}this.visible_=!0},ClusterIcon.prototype.remove=function(){this.setMap(null)},ClusterIcon.prototype.onRemove=function(){this.div_&&this.div_.parentNode&&(this.hide(),this.div_.parentNode.removeChild(this.div_),this.div_=null)},ClusterIcon.prototype.setSums=function(a){this.sums_=a,this.text_=a.text,this.index_=a.index,this.div_&&(this.div_.innerHTML=a.text),this.useStyle()},ClusterIcon.prototype.useStyle=function(){var a=Math.max(0,this.sums_.index-1);a=Math.min(this.styles_.length-1,a);var b=this.styles_[a];this.url_=b.url,this.height_=b.height,this.width_=b.width,this.textColor_=b.textColor,this.anchor_=b.anchor,this.textSize_=b.textSize,this.backgroundPosition_=b.backgroundPosition},ClusterIcon.prototype.setCenter=function(a){this.center_=a},ClusterIcon.prototype.createCss=function(a){var b=[];b.push("background-image:url("+this.url_+");");var c=this.backgroundPosition_?this.backgroundPosition_:"0 0";b.push("background-position:"+c+";"),typeof this.anchor_=="object"?(typeof this.anchor_[0]=="number"&&this.anchor_[0]>0&&this.anchor_[0]<this.height_?b.push("height:"+(this.height_-this.anchor_[0])+"px; padding-top:"+this.anchor_[0]+"px;"):b.push("height:"+this.height_+"px; line-height:"+this.height_+"px;"),typeof this.anchor_[1]=="number"&&this.anchor_[1]>0&&this.anchor_[1]<this.width_?b.push("width:"+(this.width_-this.anchor_[1])+"px; padding-left:"+this.anchor_[1]+"px;"):b.push("width:"+this.width_+"px; text-align:center;")):b.push("height:"+this.height_+"px; line-height:"+this.height_+"px; width:"+this.width_+"px; text-align:center;");var d=this.textColor_?this.textColor_:"black",e=this.textSize_?this.textSize_:11;return b.push("cursor:pointer; top:"+a.y+"px; left:"+a.x+"px; color:"+d+"; position:absolute; font-size:"+e+"px; font-family:Arial,sans-serif; font-weight:bold"),b.join("")},window.MarkerClusterer=MarkerClusterer,MarkerClusterer.prototype.addMarker=MarkerClusterer.prototype.addMarker,MarkerClusterer.prototype.addMarkers=MarkerClusterer.prototype.addMarkers,MarkerClusterer.prototype.clearMarkers=MarkerClusterer.prototype.clearMarkers,MarkerClusterer.prototype.fitMapToMarkers=MarkerClusterer.prototype.fitMapToMarkers,MarkerClusterer.prototype.getCalculator=MarkerClusterer.prototype.getCalculator,MarkerClusterer.prototype.getGridSize=MarkerClusterer.prototype.getGridSize,MarkerClusterer.prototype.getExtendedBounds=MarkerClusterer.prototype.getExtendedBounds,MarkerClusterer.prototype.getMap=MarkerClusterer.prototype.getMap,MarkerClusterer.prototype.getMarkers=MarkerClusterer.prototype.getMarkers,MarkerClusterer.prototype.getMaxZoom=MarkerClusterer.prototype.getMaxZoom,MarkerClusterer.prototype.getStyles=MarkerClusterer.prototype.getStyles,MarkerClusterer.prototype.getTotalClusters=MarkerClusterer.prototype.getTotalClusters,MarkerClusterer.prototype.getTotalMarkers=MarkerClusterer.prototype.getTotalMarkers,MarkerClusterer.prototype.redraw=MarkerClusterer.prototype.redraw,MarkerClusterer.prototype.removeMarker=MarkerClusterer.prototype.removeMarker,MarkerClusterer.prototype.removeMarkers=MarkerClusterer.prototype.removeMarkers,MarkerClusterer.prototype.resetViewport=MarkerClusterer.prototype.resetViewport,MarkerClusterer.prototype.repaint=MarkerClusterer.prototype.repaint,MarkerClusterer.prototype.setCalculator=MarkerClusterer.prototype.setCalculator,MarkerClusterer.prototype.setGridSize=MarkerClusterer.prototype.setGridSize,MarkerClusterer.prototype.setMaxZoom=MarkerClusterer.prototype.setMaxZoom,MarkerClusterer.prototype.onAdd=MarkerClusterer.prototype.onAdd,MarkerClusterer.prototype.draw=MarkerClusterer.prototype.draw,Cluster.prototype.getCenter=Cluster.prototype.getCenter,Cluster.prototype.getSize=Cluster.prototype.getSize,Cluster.prototype.getMarkers=Cluster.prototype.getMarkers,ClusterIcon.prototype.onAdd=ClusterIcon.prototype.onAdd,ClusterIcon.prototype.draw=ClusterIcon.prototype.draw,ClusterIcon.prototype.onRemove=ClusterIcon.prototype.onRemove


// 1. Global Variables / Initialization

var host = window.location.host.split('.');
var sub = host[0];
//var orlando = new google.maps.LatLng(28.537851,-81.37931);
var orlando = new google.maps.LatLng(28.102641,-82.269203);
var zoomLevel = 7;
var searchCount = 0;
var priceTip = false;
var drawTip = false;
var map = new google.maps.Map(document.getElementById("map-canvas"), {
	center: orlando,
	zoom: zoomLevel,
    panControl: true,
    panControlOptions: {
        position: google.maps.ControlPosition.TOP_RIGHT
    },
	zoomControl: true,
	zoomControlOptions: {
        position: google.maps.ControlPosition.TOP_RIGHT
	},
	mapTypeId: google.maps.MapTypeId.ROADMAP});
//var mc = new MarkerClusterer(map, markers, {gridSize: 20});
var lastSearch = '';
var markers = [];
var infobox = new InfoBox({
	alignBottom: true,
	closeBoxMargin: '4px',
	closeBoxURL: '/halyard/wp-content/themes/galleon/img/x.gif',
	pixelOffset: new google.maps.Size(-50, -40),
	enableEventPropagation: true,
	infoBoxClearance: new google.maps.Size(1, 10),
 	height_: 165,
	width_: 266});
var searchLock = true; // switch to prevent re-searching during certain conditions. Initially true because page load map resizing triggers bounds_changed event, which turns this off.
var geocoder = new google.maps.Geocoder();
var drawingManager = new google.maps.drawing.DrawingManager({
	drawingControl: true,
	drawingControlOptions: {
		position: google.maps.ControlPosition.TOP_CENTER,
		drawingModes: [google.maps.drawing.OverlayType.POLYGON, google.maps.drawing.OverlayType.CIRCLE]
	},
	polygonOptions: {
		fillColor: '#2a64a4',
		fillOpacity: .4,
		strokeWeight: 1,
		clickable: false,
		zIndex: 1,
		editable: false
	},
	circleOptions: {
		fillColor: '#73ac60',
		fillOpacity: .4,
		strokeWeight: 1,
		clickable: false,
		zIndex: 1,
		editable: false
	}});
var view = '';
var overlay = new google.maps.Polygon({map:map});
var circleCenter = '';
var circleRadius = 0;
var polyCoords = [];
drawingManager.setMap(map);
// Notable: http://code.google.com/p/polygonzo/source/browse/code/polymap.js
var bounds = new google.maps.LatLngBounds(
	new google.maps.LatLng(28.5, -81.6),
	new google.maps.LatLng(28.6, -81.1));
// size map to window
function mapsize() { $('#map-canvas').height($(window).height()-120); }


// 2. Events

mapsize();
$(window).resize(mapsize);
google.maps.event.addListener(map, 'bounds_changed', function() {
	if(map.getZoom() != zoomLevel) { // clicking marker sometimes moves map; lock prevents reloading. This is to detect manual map move.
		zoomLevel = map.getZoom();
	}
	searchDelay(2000);
});
google.maps.event.addListener(drawingManager, 'overlaycomplete', function(o) {
	overlay.setMap(null);
	overlay = o.overlay;
	searchLock = false;
	$('#cleardrawings').fadeIn(200);
	switch(o.type) {
		case google.maps.drawing.OverlayType.CIRCLE :
			polyCoords = [];
			circleCenter = o.overlay.getCenter();
			circleRadius = o.overlay.getRadius();
			searchDelay(1500);
			break;
		case google.maps.drawing.OverlayType.POLYGON :
			circleCenter = '';
			circleRadius = 0;
			polyCoords = o.overlay.getPath().getArray();
			searchDelay(1500);
			break;
	}
	if(!drawTip) {
		setTimeout(function() {
			$('#tip-window').html('<strong>Tip:</strong> click on the hand tool after you&rsquo;re done drawing').fadeIn(200, function() {
				setTimeout(function(){$('#tip-window').fadeOut(200);drawTip = true;}, 6000);
			})
		}, 2000);
	}
});
google.maps.event.addListener(infobox, 'content_changed', function() {
	setTimeout(function() {
		$('a.photo').fancybox({margin:0});
		$('a.link').fancybox({content:'<div class="permalink"><h3>Link to this listing:</h3><input type="text" class="url" value="http://galleonproperties.com/#!/'+$('a.link').attr('rel')+'" /></div>', titleShow: false, width:500});
		$('a.disclaimer').fancybox({content:'<div class="italic">Galleon Properties uses the latest information directly from the MLS. By using our service, you agree to use this information for personal, non-commercial use for the sole purpose of identifying prospective properties with the intent to purchase. This data is deemed reliable but is not guaranteed accurate by the providing MLS. While we do our very best in actively updating and maintaining these listings, neither Galleon Properties nor the providing MLS may be held responsible for inaccuracies in listing information and/or map placement of listing.</div>', titleShow: false});
		$('#showform').html('<h2>Schedule a showing</h2><input id="dontfillout" name="dontfillout" value="" style="display:none;" /><input type="hidden" id="smls" name="mls" value="" /><div id="card"></div><label><div class="left">Desired Date</div><div class="right"><input type="input" id="sdate" name="date" style="width:160px;"/></div></label><label><div class="left">Email</div><div class="right"><input type="email" name="electronicmail" value="" /></div></label><input type="submit" class="send" name="submit" value="Send" />');
		$('#askform').html('<h2>Ask a Question</h2><input id="dontfillout" name="dontfillout" value="" style="display:none;" /><input type="hidden" id="qmls" name="mls" value=""/><div id="qcard"></div><label><div class="left">Email</div><div class="right"><input type="email" name="electronicmail" value="" /></div></label><label><div class="left">Question</div><div class="right"><textarea id="question" name="question"></textarea></div></label><input type="submit" class="send" name="submit" value="Send" />');
	}, 500);
});


// 3. Google Map Functions

function addMarker(i,limit,latlng,info,green,auto_open) {
	var icon = (green == 1) ? 'http://www.google.com/mapfiles/marker_green.png' : 'http://www.google.com/mapfiles/marker.png';
	var animation = (limit-i > 20) ? null : google.maps.Animation.DROP; // only animate the last 20 markers
	var t = (limit-i > 20) ? 0 : i; // only set timeout for the last 20 markers (so they drop in quick sequence)

	var marker = new google.maps.Marker({
		position: latlng,
		icon: icon,
		map: map,
		animation: animation
	});
	setTimeout(function() { // setTimeout(fn, 0) is actually helpful (http://stackoverflow.com/questions/779379/why-is-settimeoutfn-0-sometimes-useful)
		google.maps.event.addListener(marker, 'click', (function(marker) {
			return function() {
			if(zoomLevel < 11 && markers.length > 30) {
				zoomLevel = 13;
				map.setZoom(zoomLevel);
				map.panTo(latlng);
			}
			//map.setCenter(latlng);
			searchLock = true;
			infobox.setContent(info);
	    	infobox.open(map, marker);
		}
		})(marker));
		if(auto_open) {
			infobox.setContent(info);
			infobox.open(map, marker);
		}
		markers.push(marker);
	}, t*10);
}

function clearDisplay() {
	if(markers) {
		$.each(markers, function(i, x) {
			x.setMap(null);
		});
		markers.length = 0;
	}
	infobox.close();
}

function greyout() {
	if(!circleCenter && !circleRadius && polyCoords.length < 1) {
		overlay.setMap(null);
	} else {
		overlay.setOptions({fillColor:'#808080'});
	}
}


// 4. Common JS functions

var timer; // sets timer in global scope
hash = window.location.hash;
hash = decodeURIComponent(hash.slice(3));
function between(value, left, right) { 
   return value >= left && value <= right; 
}

function searchDelay(w) {
	w = typeof w !== 'undefined' ? w : 3000;
	clearTimeout(timer);
	timer = setTimeout(function() {
		if(!searchLock) {
			searchSubmit();
		} else {
			searchLock = false;
		}
	}, w);
}
function searchSubmit() {
    window.location.hash = '!/'+encodeURIComponent($('#location').val());
	greyout();
	var searchBounds = map.getBounds();
	var postdata = '';
	var location = $('#location').val();
	$('#searchform').find('input, select').each(function(){
		if($(this).is('#price-min, #price-max, #year-min, #year-max, #beds, #baths, #sqft, #garage')) {
			a = numDecode($(this).val());
		} else if($(this).is('#pets')) {
			a = ($(this).is(':checked')) ? 1 : 0;
		} else {
			a = $(this).val();
		}
		postdata += $(this).attr('name')+'='+a+'&';
	});
	postdata += 'bounds='+searchBounds;
	postdata += (circleCenter) ? '&circleCenter='+circleCenter : '';
	postdata += (circleRadius) ? '&circleRadius='+circleRadius : '';
	postdata += (polyCoords) ? '&polyCoords='+polyCoords : '';
	$.ajax({url: '/searchhandler.php',
		type: 'POST',
		data: postdata,
		timeout: 20000, // 10 sec timeout
		beforeSend: function() { clearDisplay(); $('#info-window').hide(); $('#load-overlay').fadeIn(200);},
		error: function(jqXHR, status, error) { $('#load-overlay').stop(true).hide();},
		success: function(data) {
			$('#load-overlay').stop(true).hide();
			data = eval('(' + data + ')');
			var shown = ''
			if(data.count > data.limit) {
				$('#info-window').html('<h4>Over '+data.limit+' listings returned</h4> Try drawing on the map (above), or narrow down your search on the left').fadeIn(200, function() {
					setTimeout(function() {$('#info-window').fadeOut(200);}, 6000);
				});
				shown = ' ('+data.limit+' shown)';
			}
			var count = '';
			switch(sub) {
				case 'es' :
					count = (data.count == 1) ? '1 Resultado': data.count+' Resultados';
					break;
				default :
					count = (data.count == 1) ? '1 Result': data.count+' Results';
					break;
			}
			$('#results').html(count+shown);
			switch(data.results.length) {
				case 0 : // if no homes returned
	// Go away		$('#info-window').fadeIn(200).html('<h4>The site is currently down for maintenance.</h4> Sorry for the inconvenience. We&rsquo;ll be back tomorrow, Sunday, June 10.');					
					$('#info-window').fadeIn(200).html('<h4>No listings found.</h4> Try modifying your search, or zooming out.');
					setTimeout(function() {
						$('#info-window').fadeOut(200);
					}, 8000)
					break;
				case 1 :
					searchLock = true;
					if(location != lastSearch) { // skip if user trying to pan map
						map.panTo(new google.maps.LatLng(data.map.lat, data.map.lng));		
						map.setZoom(data.map.zoom);
						lastSearch = location;
					}
					var marker = data.results[0];
					var latlng = new google.maps.LatLng(marker.lat, marker.lng);
					var unit = (marker.unit) ? ' # '+marker.unit : '';
					var photos = '';
					var available = '';
					var pool = (marker.pool) ? marker.pool+ ' Pool<br />' : '';
					var garage = (marker.garage_size > 0) ? marker.garage_size+' Car Garage<br />' : '';
					var subdivision = (marker.subdivision) ? '<strong>'+marker.subdivision+'</strong><br />' : '';
					var waterfront = (marker.water_front.length > 0) ? 'Waterfront: '+marker.water_front.join(' / ')+'<br />' : '';
					var yearbuilt = (marker.year_built) ? 'Built in '+marker.year_built+'<br />' : '';
					var taxes = (marker.taxes > 0) ? 'Taxes: $'+marker.taxes+'<br />' : '';
					var hoa = (marker.hoa_fee > 0) ? 'HOA Fee: $'+marker.hoa_fee : '';
					var sp = (marker.sale_provision) ? marker.sale_provision+'<br />' : '';
					var sr = (marker.distressed) ? '<a class="distressed" target="_blank" href="/rentals/?cc='+marker.lat+','+marker.lng+'&cr=1600">AnalyzeRental Comps</a>' : '';
					var pets = '';
					if(marker.pets_allowed) {
						switch(marker.pets_allowed) {
							case 0 :
								pets = 'No Pets Allowed<br />';
								break;
							default :
								pets = 'Pets Allowed<br />';
								break;
						}
					}
					var style = (marker.property_style) ? 'Style: '+marker.property_style+'<br />' : '';
					var tour = (marker.virtual_tour) ? '<a href="'+marker.virtual_tour+'" target="_blank">Virtual Tour &rarr;</a><br />' : '';
					if(marker.date_available) available = 'Available on '+marker.date_available;
					if(marker.photos) {
						$.each(marker.photos, function(p, photo) {
							var pclass, w;
							switch(p) {
								case 0 :
									pclass = 'large';
									w = 112;
									break;
								default :
									pclass = 'small';
									w = 35;
									break;
							}
							if(p < 9) {
								photos += '<a class="photo '+pclass+'" href="'+photo+'" rel="gallery" style="background-image:url(\''+photo+'\');">'+marker.mlsid+'</a>';
							}
						});
					}
					var green = marker.green_certification == 1 ? '<div class="green"><a title="This home utilizes environmentally-friendly technology">Green Certification</a></div>' : '';
					content = '<div class="blue">'+photos+'</div>';
					content += '<div class="tan"><h1>'+marker.address+unit+'</h1>';
					content += '<h2>'+marker.city+', '+marker.state+' '+marker.zip_code+'</h2></div>';
					content += '<div class="white"><div class="info"><div class="price"><span class="dollar">$</span>'+marker.price+'</div>';
					content += '<div class="stats">'+marker.bed+' bed, '+marker.bath+' bath<br />'+marker.sq_ft+marker.lot_size+'</div>'+sr;
					content += '<div class="moreinfo">'+subdivision+'<div class="left">'+style+yearbuilt+pets+garage+pool+waterfront+tour+'</div><div class="right">MLS: '+marker.mlsid+'<br />'+sp+taxes+hoa+'</div></div><a class="link" rel="'+marker.mlsid+'" title="Link to this listing">Link to this listing</a><a href="mailto:?subject=Galleon%20Properties:%20'+marker.address+'%20'+marker.city+'&body=Look%20at%20this%20great%20listing%20I%20found%20on%20Galleon%20Properties!%0A%0Ahttp://galleonproperties.com/#!/'+marker.mlsid+'" class="sendthis" title="Email this listing">Email this listing</a><a class="disclaimer" title="IDX Info">IDX Info</a>'+green+'</div>';
					content += '<div class="fineprint">Listing provided by '+marker.mls+'</div>';
					content += '<div class="buttons"><a href="#" id="s'+marker.mlsid+'" class="showing" onclick="showing(\''+marker.mlsid+'\', \''+marker.address+unit+'<br />'+marker.city+', '+marker.state+' '+marker.zip_code+'\');return false;">Schedule&nbsp;a&nbsp;Showing</a><a href="#" id="q'+marker.mlsid+'" class="question" onclick="question(\''+marker.mlsid+'\', \''+marker.address+unit+'<br />'+marker.city+', '+marker.state+' '+marker.zip_code+'\');return false;">Ask&nbsp;a&nbsp;Question</a></div>';
					content += '</div></div>';
					addMarker(0, data.results.length, latlng, content, marker.green_certification, true);
				break;
				default :
					i = 0;
					if(location != lastSearch) { // skip if user trying to move map
						if(data.map.n && data.map.e && data.map.s && data.map.w) {
							bounds = new google.maps.LatLngBounds(new google.maps.LatLng(data.map.s, data.map.w), new google.maps.LatLng(data.map.n, data.map.e));
							map.fitBounds(bounds);
							searchLock = true;
							var tip = '<strong>Tip:</strong> clear the location search bar to see more results.';
							if(searchCount == 2) {
								setTimeout(function() {
									$('#tip-window').html(tip).fadeIn(400, function() {
										setTimeout(function() {$('#tip-window').fadeOut(200);}, 6000);
									});
								}, 2000);
							}
							searchCount++;
						}
						lastSearch = location;
					}
					$.each(data.results, function(i, marker){
						if(marker.lat != 0 && marker.lng != 0) {
							var latlng = new google.maps.LatLng(marker.lat, marker.lng);
							var unit = (marker.unit) ? ' # '+marker.unit : '';
							var photos = '';
							var available = '';
							var pool = (marker.pool) ? marker.pool+ ' Pool<br />' : '';
							var garage = (marker.garage_size > 0) ? marker.garage_size+' Car Garage<br />' : '';
							var subdivision = (marker.subdivision) ? '<strong>'+marker.subdivision+'</strong><br />' : '';
							var waterfront = (marker.water_front.length > 0) ? 'Waterfront: '+marker.water_front.join(' / ')+'<br />' : '';
							var yearbuilt = (marker.year_built) ? 'Built in '+marker.year_built+'<br />' : '';
							var taxes = (marker.taxes > 0) ? 'Taxes: $'+marker.taxes+'<br />' : '';
							var hoa = (marker.hoa_fee > 0) ? 'HOA Fee: $'+marker.hoa_fee : '';
							var sp = (marker.sale_provision) ? marker.sale_provision+'<br />' : '';
							var sr = (marker.distressed) ? '<a class="distressed" target="_blank" href="/rentals/?cc='+marker.lat+','+marker.lng+'&cr=1600">Analyze Rental Comps</a>' : '';
							var pets = '';
							if(marker.pets_allowed) {
								switch(marker.pets_allowed) {
									case 0 :
										pets = 'No Pets Allowed<br />';
										break;
									default :
										pets = 'Pets Allowed<br />';
										break;
								}
							}
							var style = (marker.property_style) ? 'Style: '+marker.property_style+'<br />' : '';
							var tour = (marker.virtual_tour) ? '<a href="'+marker.virtual_tour+'" target="_blank">Virtual Tour &rarr;</a><br />' : '';
							if(marker.date_available) available = 'Available on '+marker.date_available;
							if(marker.photos) {
								$.each(marker.photos, function(p, photo) {
									var pclass, w;
									switch(p) {
										case 0 :
											pclass = 'large';
											w = 112;
											break;
										default :
											pclass = 'small';
											w = 35;
											break;
									}
									photos += '<a class="photo '+pclass+'" href="'+photo+'" rel="gallery" style="background-image:url(\''+photo+'\');">'+marker.mlsid+'</a>';
								});
							}
							var green = marker.green_certification == 1 ? '<div class="green"><a title="This home utilizes environmentally-friendly technology">Green Certification</a></div>' : '';
							content = '<div class="blue">'+photos+'</div>';
							content += '<div class="tan"><h1>'+marker.address+unit+'</h1>';
							content += '<h2>'+marker.city+', '+marker.state+' '+marker.zip_code+'</h2></div>';
							content += '<div class="white"><div class="info"><div class="price"><span class="dollar">$</span>'+marker.price+'</div>';
							content += '<div class="stats">'+marker.bed+' bed, '+marker.bath+' bath<br />'+marker.sq_ft+marker.lot_size+'</div>'+sr;
							content += '<div class="moreinfo">'+subdivision+'<div class="left">'+style+yearbuilt+pets+garage+pool+waterfront+tour+'</div><div class="right">MLS: '+marker.mlsid+'<br />'+sp+taxes+hoa+'</div></div><a class="link" rel="'+marker.mlsid+'" title="Link to this listing">Link to this listing</a><a href="mailto:?subject=Galleon%20Properties:%20'+marker.address+'%20'+marker.city+'&body=Look%20at%20this%20great%20listing%20I%20found%20on%20Galleon%20Properties!%0A%0Ahttp://galleonproperties.com/#!/'+marker.mlsid+'" class="sendthis" title="Email this listing">Email this listing</a><a class="disclaimer" title="IDX Info">IDX Info</a>'+green+'</div>';
							content += '<div class="fineprint">Listing provided by '+marker.mls+'</div>';
							content += '<div class="buttons"><a href="#" id="s'+marker.mlsid+'" class="showing" onclick="showing(\''+marker.mlsid+'\', \''+marker.address+unit+'<br />'+marker.city+', '+marker.state+' '+marker.zip_code+'\');return false;">Schedule&nbsp;a&nbsp;Showing</a><a href="#" id="q'+marker.mlsid+'" class="question" onclick="question(\''+marker.mlsid+'\', \''+marker.address+unit+'<br />'+marker.city+', '+marker.state+' '+marker.zip_code+'\');return false;">Ask&nbsp;a&nbsp;Question</a></div>';
							content += '</div></div>';
							addMarker(i, data.results.length, latlng, content, marker.green_certification, false);
							i++;
						}
					});
					break;
			}
		}
	});
}
// returns comma-separated numbers up to 100 K, then returns ### K until ### M.
function numEncode(a) {
	var b = a.toString();
	if (a < 1000) {
		return a;
	} else if (a < 100000) {
		return addCommas(a);
	} else if (a < 1000000) {
		return b.substr(0, b.length - 3) + ' K';
	} else if (a < 1000000000) {
		return b.substr(0, b.length - 6)+'.'+b.substr(1, b.length - 5) + ' M';
	} else {
		return 0;
	}
}
// returns 210K, 1M, etc. and comma-separated strings into numbers; returns 0 on NaN
function numDecode(a) {
	b = stripCommas(a);
	b = b.replace(/\s/g,'').toLowerCase();
	if(typeof b == 'string') {
		if (b.indexOf('k') > 0) {
			b = parseFloat(b, 10);
			b = b * 1000;
		} else if (b.indexOf('m') > 0) {
			b = parseFloat(b, 10);
			b = b * 1000000;
		}
	}
	if(isNaN(b)) {
		return 0;
	} else {
		return b;
	}
}

function addCommas(a) {
    a += '';
    var x = a.split('.');
    var x1 = x[0];
    var x2 = x.length > 1 ? '.' + x[1] : '';
    var rgx = /(\d+)(\d{3})/;
    while (rgx.test(x1)) {
        x1 = x1.replace(rgx, '$1' + ',' + '$2');
    }
    return x1 + x2;
}

function stripCommas(a) {
	return a.replace(/,/g, "");
}

function searchPos(addon) {
	var p = $('#searchbox').position();
	var h = $('#searchbox').height()+addon;
	var m = $(window).height();
	if(p.top+65+h > m) $('#searchbox').animate({top: m-65-h}, 400);
}


// 5. UI setup & UI Events

function question(mls, address) {
	searchLock = true;
	$('#ask').show();
	$('#qcard').html('MLS: '+mls+'<br />'+address);
	$('#qmls').val(mls);
	$('#dark-overlay').fadeIn(200);
}

function showing(mls, address) {
	searchLock = true;
	$('#schedule').show();
	$('#smls').val(mls);
	$('#card').html('MLS: '+mls+'<br />'+address);
	$('#sdate').datepicker({minDate:2, dateFormat: 'M d, yy'});
	$('#dark-overlay').fadeIn(200);
}
$('#searchform').find('input').keydown(function(e){
	switch(e.keyCode) {
		case 13 :
			clearTimeout(timer);
			$('#location').autocomplete('close');
			searchLock = true;
			searchSubmit();
		break;
		case 32 :
			searchDelay();
		default :
			if(!between(e.keyCode, 9, 45) && !between(e.keyCode, 91, 93) && !between(e.keyCode, 112, 145)) {
				searchDelay();
			}
		break;
	}
});
$('#searchform').find('select').change(function(){
	searchDelay();
});
$('#searchbox').draggable({handle: $('#searchhandle'), containment: $('#map-canvas')});
if(hash != '') {
	searchLock = false;
	$('#location').val(hash);
	searchDelay();
}
$('#location').autocomplete({
	source: ['Alachua, FL', 'Altamonte Spg, FL', 'Altamonte Springs, FL', 'Altoona, FL', 'Alturas, FL', 'Anna Maria, FL', 'Anywhere, FL', 'Ap, FL', 'Apollo Beach, FL', 'Apopka, FL', 'Arcadia, FL', 'Aripeka, FL', 'Astatula, FL', 'Astor, FL', 'Auburndale, FL', 'Avon Park, FL', 'Babson Park, FL', 'Barberville, FL', 'Bartow, FL', 'Bayonet Point, FL', 'Bell, FL', 'Belle Isle, FL', 'Belleair, FL', 'Belleair Beach, FL', 'Belleair Bluffs, FL', 'Belleair Shore, FL', 'Belleair Shores, FL', 'Belleview, FL', 'Bellview, FL', 'Boca Grande, FL', 'Bokeelia, FL', 'Bonifay, FL', 'Bonita Springs, FL', 'Boynton Beach, FL', 'Boyton Beach, FL', 'Bradenton, FL', 'Bradenton Bch, FL', 'Bradenton Beach, FL', 'Bradenton,, FL', 'Bradley, FL', 'Brandenton, FL', 'Brandenton Beach, FL', 'Brandetnon, FL', 'Brandon, FL', 'Brookesville, FL', 'Brooksville, FL', 'Bunnell, FL', 'Burnt Store, FL', 'Bushnell, FL', 'Cape Canaveral, FL', 'Cape Coral, FL', 'Cape Haze, FL', 'Cape Haze/placida, FL', 'Captiva, FL', 'Casselberry, FL', 'Celebration, FL', 'Center Hill, FL', 'Champions Gate, FL', 'Championsgate, FL', 'Christmas, FL', 'Chuluota, FL', 'Citrus Springs, FL', 'Clearwater, FL', 'Clearwater Beach, FL', 'Clearwater, Clearwat, FL', 'Clermont, FL', 'Clermont (groveland), FL', 'Coa, FL', 'Cocoa, FL', 'Cocoa Beach, FL', 'Coleman, FL', 'Cortez, FL', 'Crystal Beach, FL', 'Crystal River, FL', 'Dade City, FL', 'Davenport, FL', 'Davenport Rd, FL', 'Davie, FL', 'Daytona Beach, FL', 'Daytona Beach Shores, FL', 'De Leon Springs, FL', 'Debary, FL', 'Deer Island, FL', 'Deland, FL', 'Deltona, FL', 'Dover, FL', 'Duette, FL', 'Dundee, FL', 'Dunedin, FL', 'Dunnellon, FL', 'Eagle Lake, FL', 'Eaton Park, FL', 'Eatonville, FL', 'Edgewater, FL', 'Edgewood, FL', 'Ellenton, FL', 'Englewood, FL', 'Enterprise, FL', 'Eustis, FL', 'Everglades, FL', 'Fanning Springs, FL', 'Fedhaven, FL', 'Fern Park, FL', 'Fern Park/casselberr, FL', 'Ferndale, FL', 'Flagler Beach, FL', 'Floral City, FL', 'Fort Meade, FL', 'Fort Myers, FL', 'Fort Ogden, FL', 'Fort Pierce, FL', 'Frostproof, FL', 'Fruitland Park, FL', 'Ft Myers, FL', 'Ft Pierce, FL', 'Gainesville, FL', 'Gainsville, FL', 'Geneva, FL', 'Georgetown,, FL', 'Gibsonton, FL', 'Gotha, FL', 'Grand Island, FL', 'Groveland, FL', 'Gulfport, FL', 'Haines City, FL', 'Harmony, FL', 'Hawthorne, FL', 'Heathrow, FL', 'Hernando, FL', 'Hernando Beach, FL', 'Holiday, FL', 'Holly Hill, FL', 'Holmes Beach, FL', 'Homeland, FL', 'Homosassa, FL', 'Howey In The Hills, FL', 'Howey-in-the-hills, FL', 'Hudson, FL', 'Indialantic, FL', 'Indian Lake Estates, FL', 'Indian Rocks Beach, FL', 'Indian Shores, FL', 'Indiatlantic, FL', 'Inglis, FL', 'Intercession City, FL', 'Inverness, FL', 'Jacksonville, FL', 'Jensen Beach, FL', 'Kathleen, FL', 'Kenansville, FL', 'Kenneth City, FL', 'Key West, FL', 'Kissimmee, FL', 'Lady Lake, FL', 'Lake Alfred, FL', 'Lake City, FL', 'Lake Hamilton, FL', 'Lake Helen, FL', 'Lake Mary, FL', 'Lake Mary (heathrow), FL', 'Lake Mary / Heathrow, FL', 'Lake Mary/heathrow, FL', 'Lake Panasoffkee, FL', 'Lake Placid, FL', 'Lake Suzy, FL', 'Lake Wales, FL', 'Lake Worth, FL', 'Lakeland, FL', 'Lakeshore, FL', 'Lakewood Ranch, FL', 'Lakewood Rch, FL', 'Land O Lakes, FL', 'Land O’ Lakes, FL', 'Land O’lakes, FL', 'Largo, FL', 'Lecanto, FL', 'Leesburg, FL', 'Lehigh Acres, FL', 'Lgi, FL', 'Lithia, FL', 'Little Gasparilla Il, FL', 'Little Gasparilla Is, FL', 'Lon, FL', 'Lonboat Key, FL', 'Longboat Key, FL', 'Longwood, FL', 'Lorida, FL', 'Lutz, FL', 'Macclenny, FL', 'Madeira Beach, FL', 'Madiera Beach, FL', 'Maitland, FL', 'Manasota Key, FL', 'Marco Island, FL', 'Marianna, FL', 'Masaryktown, FL', 'Mascotte, FL', 'Mcintosh, FL', 'Melborne, FL', 'Melbourne, FL', 'Melrose, FL', 'Merritt Island, FL', 'Miami, FL', 'Miami Gardens, FL', 'Mims, FL', 'Mims - Geneva, FL', 'Minneola, FL', 'Miramar, FL', 'Montverde, FL', 'Moore Haven, FL', 'Moorehaven, FL', 'Morriston, FL', 'Mount Dora, FL', 'Mt. Dora, FL', 'Mulberry, FL', 'Myakka City, FL', 'N. Venice, FL', 'Naples, FL', 'New Port Richey, FL', 'New Port Richey/trin, FL', 'New Smyrna Beach, FL', 'No Venice, FL', 'Nobleton, FL', 'Nokomis, FL', 'North Fort Myers, FL', 'North Fort Myers, FL', 'North Port, FL', 'North Redington Beac, FL', 'North Redington Shor, FL', 'North Venice, FL', 'Oak Hill, FL', 'Oakland, FL', 'Ocala, FL', 'Ocklawaha, FL', 'Ocoee, FL', 'Odessa, FL', 'Okahumpka, FL', 'Okeechobee, FL', 'Old Town, FL', 'Oldsmar, FL', 'Ona, FL', 'Orando, FL', 'Orange City, FL', 'Orlando, FL', 'Ormond Beach, FL', 'Osprey, FL', 'Osteen, FL', 'Other, FL', 'Out Of Area, FL', 'Oviedo, FL', 'Oxford, FL', 'Paisley, FL', 'Palm Bay, FL', 'Palm Beach, FL', 'Palm Coast, FL', 'Palm Harbor, FL', 'Palm Island, FL', 'Palmetto, FL', 'Pampano Beach, FL', 'Parkland, FL', 'Parrish, FL', 'Pasco Trails, FL', 'Pembroke Pines, FL', 'Pierson, FL', 'Pinellas Park, FL', 'Placida, FL', 'Plant City, FL', 'Plantation, FL', 'Poinciana, FL', 'Polk City, FL', 'Pompano Beach, FL', 'Ponce Inlet, FL', 'Port Charlotte, FL', 'Port Orange, FL', 'Port Richey, FL', 'Port Saint Lucie, FL', 'Port St Lucie, FL', 'Port St. Lucie, FL', 'Pt Charlotte, FL', 'Ptstluce, FL', 'Punta Gorda, FL', 'Reddick, FL', 'Redington, FL', 'Redington Beach, FL', 'Redington Shores, FL', 'Reunion, FL', 'Ridge Manor, FL', 'Riverview, FL', 'Rockedge, FL', 'Rockledge, FL', 'Rotonda West, FL', 'Ruskin, FL', 'Sa, FL', 'Safety Harbor, FL', 'Saint Cloud, FL', 'Saint James City, FL', 'Saint Pete Beach, FL', 'Saint Petersburg, FL', 'Salt Springs, FL', 'San Antonio, FL', 'Sanford, FL', 'Sanford (lake Forest, FL', 'Sanibel, FL', 'Sar, FL', 'Sarasota, FL', 'Sarsota, FL', 'Sebastian, FL', 'Sebring, FL', 'Seffner, FL', 'Seminole, FL', 'Seville, FL', 'Siesta Key, FL', 'Silver Springs, FL', 'Smmerfield, FL', 'Sorrento, FL', 'South Daytona, FL', 'South Gulf Cove, FL', 'South Pasadena, FL', 'Spring Hill, FL', 'Springhill, FL', 'Sprinh Hill, FL', 'St Petersburg, FL', 'St Cloud, FL', 'St Pete Beach, FL', 'St Peterburg, FL', 'St Petersburg, FL', 'St. Cloud, FL', 'St. Pete Beach, FL', 'St. Petersburg, FL', 'Stuart, FL', 'Summefield, FL', 'Summerfield, FL', 'Summerfiled, FL', 'Summerield, FL', 'Sumterville, FL', 'Sun City Center, FL', 'Sunny Isles Beach, FL', 'Sunrise, FL', 'Tallahassee, FL', 'Tamarac, FL', 'Tampa, FL', 'Tapma, FL', 'Tarpon Springs, FL', 'Tavares, FL', 'Temple Terrace, FL', 'Terra Ceia, FL', 'The Villages, FL', 'Thonotosassa, FL', 'Tierra Verde, FL', 'Titusville, FL', 'Tituville, FL', 'Treasure Island, FL', 'Trenton, FL', 'Trinity, FL', 'Umatilla, FL', 'Un-incorporated, FL', 'University Park, FL', 'University Pk, FL', 'Valrico, FL', 'Venic, FL', 'Venice, FL', 'Vero Beach, FL', 'Waldo, FL', 'Wauchula, FL', 'Waverly, FL', 'Webster, FL', 'Weeki Wachee, FL', 'Weirsdale, FL', 'Wesley Chapel, FL', 'West Melbourne, FL', 'West Palm Beach, FL', 'Wiersdale, FL', 'Wilbur By The Sea, FL', 'Wildwood, FL', 'Williston, FL', 'Wimauma, FL', 'Windermere, FL', 'Winter Garden, FL', 'Winter Haven, FL', 'Winter Park, FL', 'Winter Spgs, FL', 'Winter Springs, FL', 'Yalaha, FL', 'Zellwood, FL', 'Zephryhills, FL', 'Zephyhrills, FL', 'Zephyrhills, FL', 'Zolfo Springs, FL', 'Zolfo Springs, FL'],
	select: function(event, ui) {
		searchSubmit();
	}
});
var step = parseInt($('#step').val());
var highend = parseInt($('#highend').val());
var pricemin = numDecode($('#price-min').val());
var pricemax = ($('#price-max').val().toLowerCase() == 'any' || $('#price-max').val().toLowerCase() == 'todo') ? highend : numDecode($('#price-max').val());
var priceslider = $('#price-slider').slider({range: true, min: 0, max: highend, values: [pricemin,pricemax], step:step, slide: function( event, ui ) {
		searchLock = false;
		// Changes top range to 'Any';
		$('#price-min').val(numEncode(ui.values[0]));
		if(ui.values[1] == highend) {
			switch(sub) {
				case 'es' :
					$('#price-max').val('Todo');
					break;
				default :
					$('#price-max').val('Any');
					break;
			}
		} else {
			$('#price-max').val(numEncode(ui.values[1]));
		}
		if(!priceTip) {
			setTimeout(function() {
			$('#tip-window').html('<strong>Tip:</strong> You can enter in values higher than '+numEncode(highend)+' manually in the boxes').fadeIn(200, function() {
					setTimeout(function() {
						$('#tip-window').fadeOut(200);
					}, 6000)
				})
			}, 2000);
			priceTip = true;
		}
		searchDelay();
	}
});
$('#price-min, #price-max').change(function () {
	searchLock = false;
	var a = $('#price-min').val();
	var b = $('#price-max').val();
	a = (a.toLowerCase() == 'any' || a.toLowerCase() == 'todo') ? 0 : numDecode(a);
	b = (b.toLowerCase() == 'any' || b.toLowerCase() == 'todo') ? highend : numDecode(b);
	if(a > b) {
		priceslider.slider({values: [b, b]});
	} else {
		priceslider.slider({values: [a, b]});
	}
});
var thisyear = (new Date).getFullYear();
var yearmin = ($('#year-min').val().toLowerCase() == 'any' || $('#year-min').val().toLowerCase() == 'todo') ? 1949 : numDecode($('#year-min').val());
var yearmax = ($('#year-max').val().toLowerCase() == 'any' || $('#year-max').val().toLowerCase() == 'todo') ? thisyear : numDecode($('#year-max').val());
var yearslider = $('#year-slider').slider({range: true, min: 1949, max: thisyear, values: [yearmin,yearmax], step:1, slide: function( event, ui ) {
		searchLock = false;
		// Changes bottom range to 'Any' (1949 == any year before max); fixes max range to 1950 — current year
		var ymintext = '';
		switch(sub) {
			case 'es' :
				ymintext = 'Todo';
				break;
			default :
				ymintext = 'Any'
				break;
		}
		if(ui.values[0] == 1949) $('#year-min').val(ymintext); else $('#year-min').val(ui.values[0]);
		if(ui.values[1] == 1949) $('#year-max').val(1950); else $('#year-max').val(ui.values[1]);
		searchDelay();
	}
});
$('#year-min, #year-max').change(function() {
	searchLock = false;
	var a = $('#year-min').val();
	var b = $('#year-max').val();
	a = (a.toLowerCase() == 'any' || a.toLowerCase() == 'todo') ? 1949 : numDecode(a);
	b = (b.toLowerCase() == 'any' || b.toLowerCase() == 'todo') ? thisyear : numDecode(b);
	if(a > b) {
		yearslider.slider({values: [b, b]});
	} else {
		yearslider.slider({values: [a, b]});
	}
});
$('#searchcollapse').click(function(){
	searchLock = false;
	var addon = 0;
	if($('#searchform').is(':hidden') && $('#extra').hasClass('down')) {
		addon = 463;
	} else if($('#searchform').is(':hidden')) {
		addon = 243;
	} else {
		addon = 0;
	}
	searchPos(addon);
	$('#searchform').stop(true).slideToggle(300);
	$(this).toggleClass('down');
	return false;
});
$('#more-terms').click(function(){
	searchLock = false;
	var addon = $('#extra').is(':visible') ? 0 : 220;
	searchPos(addon);
	$('#extra').stop(true).toggleClass('down').slideToggle(300, function() {
		var label = '';
		switch(sub) {
			case 'es' :
				label = $(this).is(':visible') ? 'Menos' : 'Más';
			break;
			default :
				label = $(this).is(':visible') ? 'Less' : 'More';
			break;
		}
		$('#more-terms').text(label);
	});
	return false;
});
$('#cleardrawings').click(function() {
	circleRadius = 0;
	circleCenter = '';
	polyCoords = [];
	overlay.setMap(null);
	searchDelay();
	$(this).fadeOut(200);
});
$(document).delegate('input.url', 'click', function() {$(this).select();});
$(document).delegate('a.photo', 'click', function() {return false;});
